"use strict";const k=require("./gamecontrol.js");require("./gamepad-22688b91.js");var x=typeof navigator<"u"?navigator.userAgent.toLowerCase().indexOf("firefox")>0:!1;function C(e,r,t,n){e.addEventListener?e.addEventListener(r,t,n):e.attachEvent&&e.attachEvent("on".concat(r),function(){t(window.event)})}function U(e,r){for(var t=r.slice(0,r.length-1),n=0;n<t.length;n++)t[n]=e[t[n].toLowerCase()];return t}function B(e){typeof e!="string"&&(e=""),e=e.replace(/\s/g,"");for(var r=e.split(","),t=r.lastIndexOf("");t>=0;)r[t-1]+=",",r.splice(t,1),t=r.lastIndexOf("");return r}function V(e,r){for(var t=e.length>=r.length?e:r,n=e.length>=r.length?r:e,i=!0,s=0;s<t.length;s++)n.indexOf(t[s])===-1&&(i=!1);return i}var K={backspace:8,"⌫":8,tab:9,clear:12,enter:13,"↩":13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,delete:46,ins:45,insert:45,home:36,end:35,pageup:33,pagedown:34,capslock:20,num_0:96,num_1:97,num_2:98,num_3:99,num_4:100,num_5:101,num_6:102,num_7:103,num_8:104,num_9:105,num_multiply:106,num_add:107,num_enter:108,num_subtract:109,num_decimal:110,num_divide:111,"⇪":20,",":188,".":190,"/":191,"`":192,"-":x?173:189,"=":x?61:187,";":x?59:186,"'":222,"[":219,"]":221,"\\":220},v={"⇧":16,shift:16,"⌥":18,alt:18,option:18,"⌃":17,ctrl:17,control:17,"⌘":91,cmd:91,command:91},S={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey",shiftKey:16,ctrlKey:17,altKey:18,metaKey:91},u={16:!1,18:!1,17:!1,91:!1},o={};for(var E=1;E<20;E++)K["f".concat(E)]=111+E;var d=[],T=!1,D="all",$=[],A=function(r){return K[r.toLowerCase()]||v[r.toLowerCase()]||r.toUpperCase().charCodeAt(0)},F=function(r){return Object.keys(K).find(function(t){return K[t]===r})},X=function(r){return Object.keys(v).find(function(t){return v[t]===r})};function q(e){D=e||"all"}function O(){return D||"all"}function z(){return d.slice(0)}function J(){return d.map(function(e){return F(e)||X(e)||String.fromCharCode(e)})}function Q(e){var r=e.target||e.srcElement,t=r.tagName,n=!0;return(r.isContentEditable||(t==="INPUT"||t==="TEXTAREA"||t==="SELECT")&&!r.readOnly)&&(n=!1),n}function W(e){return typeof e=="string"&&(e=A(e)),d.indexOf(e)!==-1}function Y(e,r){var t,n;e||(e=O());for(var i in o)if(Object.prototype.hasOwnProperty.call(o,i))for(t=o[i],n=0;n<t.length;)t[n].scope===e?t.splice(n,1):n++;O()===e&&q(r||"all")}function Z(e){var r=e.keyCode||e.which||e.charCode,t=d.indexOf(r);if(t>=0&&d.splice(t,1),e.key&&e.key.toLowerCase()==="meta"&&d.splice(0,d.length),(r===93||r===224)&&(r=91),r in u){u[r]=!1;for(var n in v)v[n]===r&&(b[n]=!1)}}function N(e){if(typeof e>"u")Object.keys(o).forEach(function(f){return delete o[f]});else if(Array.isArray(e))e.forEach(function(f){f.key&&j(f)});else if(typeof e=="object")e.key&&j(e);else if(typeof e=="string"){for(var r=arguments.length,t=new Array(r>1?r-1:0),n=1;n<r;n++)t[n-1]=arguments[n];var i=t[0],s=t[1];typeof i=="function"&&(s=i,i=""),j({key:e,scope:i,method:s,splitKey:"+"})}}var j=function(r){var t=r.key,n=r.scope,i=r.method,s=r.splitKey,f=s===void 0?"+":s,l=B(t);l.forEach(function(a){var c=a.split(f),g=c.length,p=c[g-1],h=p==="*"?"*":A(p);if(o[h]){n||(n=O());var w=g>1?U(v,c):[];o[h]=o[h].filter(function(y){var m=i?y.method===i:!0;return!(m&&y.scope===n&&V(y.mods,w))})}})};function I(e,r,t,n){if(r.element===n){var i;if(r.scope===t||r.scope==="all"){i=r.mods.length>0;for(var s in u)Object.prototype.hasOwnProperty.call(u,s)&&(!u[s]&&r.mods.indexOf(+s)>-1||u[s]&&r.mods.indexOf(+s)===-1)&&(i=!1);(r.mods.length===0&&!u[16]&&!u[18]&&!u[17]&&!u[91]||i||r.shortcut==="*")&&r.method(e,r)===!1&&(e.preventDefault?e.preventDefault():e.returnValue=!1,e.stopPropagation&&e.stopPropagation(),e.cancelBubble&&(e.cancelBubble=!0))}}}function H(e,r){var t=o["*"],n=e.keyCode||e.which||e.charCode;if(b.filter.call(this,e)){if((n===93||n===224)&&(n=91),d.indexOf(n)===-1&&n!==229&&d.push(n),["ctrlKey","altKey","shiftKey","metaKey"].forEach(function(y){var m=S[y];e[y]&&d.indexOf(m)===-1?d.push(m):!e[y]&&d.indexOf(m)>-1?d.splice(d.indexOf(m),1):y==="metaKey"&&e[y]&&d.length===3&&(e.ctrlKey||e.shiftKey||e.altKey||(d=d.slice(d.indexOf(m))))}),n in u){u[n]=!0;for(var i in v)v[i]===n&&(b[i]=!0);if(!t)return}for(var s in u)Object.prototype.hasOwnProperty.call(u,s)&&(u[s]=e[S[s]]);e.getModifierState&&!(e.altKey&&!e.ctrlKey)&&e.getModifierState("AltGraph")&&(d.indexOf(17)===-1&&d.push(17),d.indexOf(18)===-1&&d.push(18),u[17]=!0,u[18]=!0);var f=O();if(t)for(var l=0;l<t.length;l++)t[l].scope===f&&(e.type==="keydown"&&t[l].keydown||e.type==="keyup"&&t[l].keyup)&&I(e,t[l],f,r);if(n in o){for(var a=0;a<o[n].length;a++)if((e.type==="keydown"&&o[n][a].keydown||e.type==="keyup"&&o[n][a].keyup)&&o[n][a].key){for(var c=o[n][a],g=c.splitKey,p=c.key.split(g),h=[],w=0;w<p.length;w++)h.push(A(p[w]));h.sort().join("")===d.sort().join("")&&I(e,c,f,r)}}}}function ee(e){return $.indexOf(e)>-1}function b(e,r,t){d=[];var n=B(e),i=[],s="all",f=document,l=0,a=!1,c=!0,g="+",p=!1;for(t===void 0&&typeof r=="function"&&(t=r),Object.prototype.toString.call(r)==="[object Object]"&&(r.scope&&(s=r.scope),r.element&&(f=r.element),r.keyup&&(a=r.keyup),r.keydown!==void 0&&(c=r.keydown),r.capture!==void 0&&(p=r.capture),typeof r.splitKey=="string"&&(g=r.splitKey)),typeof r=="string"&&(s=r);l<n.length;l++)e=n[l].split(g),i=[],e.length>1&&(i=U(v,e)),e=e[e.length-1],e=e==="*"?"*":A(e),e in o||(o[e]=[]),o[e].push({keyup:a,keydown:c,scope:s,mods:i,shortcut:n[l],method:t,key:n[l],splitKey:g,element:f});typeof f<"u"&&!ee(f)&&window&&($.push(f),C(f,"keydown",function(h){H(h,f)},p),T||(T=!0,C(window,"focus",function(){d=[]},p)),C(f,"keyup",function(h){H(h,f),Z(h)},p))}function re(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"all";Object.keys(o).forEach(function(t){var n=o[t].filter(function(i){return i.scope===r&&i.shortcut===e});n.forEach(function(i){i&&i.method&&i.method()})})}var P={getPressedKeyString:J,setScope:q,getScope:O,deleteScope:Y,getPressedKeyCodes:z,isPressed:W,filter:Q,trigger:re,unbind:N,keyMap:K,modifier:v,modifierMap:S};for(var M in P)Object.prototype.hasOwnProperty.call(P,M)&&(b[M]=P[M]);if(typeof window<"u"){var te=window.hotkeys;b.noConflict=function(e){return e&&window.hotkeys===b&&(window.hotkeys=te),b},window.hotkeys=b}const ne={on:function(e,r,t="changed"){t==="repeat"?b(e,(n,i)=>{n.preventDefault(),r(1)}):b(e,{keyup:t==="released"||t==="changed"?!0:null,keydown:t==="pressed"||t==="changed"?!0:null},(i,s)=>{i.repeat||r(b.isPressed(e)===!0?1:0)})},off:function(e,r){b.unbind(e)}},G={supportedInputHandlers:["keyboard","gamepad"],handlers:{keyboard:{handler:ne,enabled:!0},gamepad:{handler:void 0,enabled:!1}},definedActions:{},registeredActions:{keyboard:{},gamepad:{}},get gamepadEnabled(){return this.handlers.gamepad.enabled},set gamepadEnabled(e){this.handlers.gamepad.enabled=e},get keyboardEnabled(){return this.handlers.keyboard.enabled},set keyboardEnabled(e){this.handlers.keyboard.enabled=e},unregisterActionsCallbacks:{},init:function(){k.on("connect",e=>{if(!this.handlers.gamepad.handler){if(this.handlers.gamepad.handler=e,!this.handlers.gamepad.enabled)return;Object.entries(this.registeredActions.gamepad).forEach(([r,t])=>{var n;(n=this.handlers.gamepad.handler)==null||n.on(r,t.handler,t.event)})}}),k.on("disconnect",e=>{e.id===this.handlers.gamepad.handler.id&&(this.handlers.gamepad.handler=void 0)}),Object.entries(k.getGamepads()).find(([e,r])=>{r!==null&&r.id!==this.handlers.gamepad.handler.id&&(this.handlers.gamepad.handler=r)})},defineInputActions:function(e,r){Object.entries(e).map(([t,n])=>{if(!(r!=null&&r.override)&&this.definedActions[t])throw new Error(`${t} action has already been defined as a dependancy.`);this.definedActions[t]=n})},onInputActions:function(e,r,t){const n=new Set;Object.entries(r).forEach(([s,f])=>{this.definedActions[s].forEach(a=>{var p,h,w,y;const c=this.registeredActions[a.type][a.key];if(c){if(c.id===e)throw new Error(`There is already a group of event registered under the id [${e}]. Unsubscribe this group of event before registering a new one`);n.add(c.id),(p=this.handlers[a.type].handler)==null||p.off(a.key,c.handler)}const g=m=>{var _,L;if(!this.handlers[a.type].enabled)return;if(!m){f();return}const R=m===1?((_=a.options)==null?void 0:_.value)??1:m===0?0:(((L=a.options)==null?void 0:L.value)??1)/1*m;f(R)};this.registeredActions[a.type][a.key]={handler:g,id:e,event:(h=a.options)==null?void 0:h.event},g.bind(this),this.handlers[a.type].enabled&&((y=this.handlers[a.type].handler)==null||y.on(a.key,g,(w=a.options)==null?void 0:w.event))})}),this.unregisterActionsCallbacks[e]=t,this.supportedInputHandlers.forEach(s=>{Object.entries(this.registeredActions[s]).forEach(([f,l])=>{var a;n.has(l.id)&&((a=this.handlers[s].handler)==null||a.off(f,l.handler),delete this.registeredActions[s][f])})});for(var i of Array.from(n.values()))this.unregisterActionsCallbacks[i]&&this.unregisterActionsCallbacks[i]()},offInputActions:function(e){this.supportedInputHandlers.forEach(r=>{Object.entries(this.registeredActions[r]).forEach(([t,n])=>{e===n.id&&delete this.registeredActions[r][t]})})}};G.init();module.exports=G;
